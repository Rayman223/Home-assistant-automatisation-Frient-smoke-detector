alias: Smoke – Silence
description: ""
triggers:
  - entity_id: input_boolean.smoke_alarm_silence
    to: "on"
    trigger: state
actions:
  - entity_id: timer.smoke_source_block
    action: timer.start
    enabled: true
  - action: script.discord_notification_personnalisee
    metadata: {}
    data:
      couleur: warning
      channel_id: "1459865652679675915"
      icone: ""
      titre: Détecteur de fumée
      message: >-
        {% set duration = state_attr('timer.smoke_source_block', 'duration') or '00:30:00' %}
        {% set parts = duration.split(':') %}
        Silence est déclenché. Les alarmes se coupent pendant
        {{ (parts[0] | int * 60) + (parts[1] | int) }} minutes.
      mention_user: "192247198170218497"
  - action: input_boolean.turn_off
    metadata: {}
    target:
      entity_id: input_boolean.alarm_is_active
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - repeat:
      until:
        - condition: state
          entity_id: timer.smoke_source_block
          state:
            - idle
      sequence:
        - entity_id: switch.groupe_alarme
          action: switch.turn_off
mode: single
